/*!
 * Name: send-message
 * Id: send-message
 * Version: 1.0.4
 * Description: Send message directly to a user using the chatbot. A plugin for red-bot .io
 * Author: Guido Bellomo (https://github.com/guidone)
 * Repository: https://github.com/guidone/red-bot-send-message
 */
define(["../../../src/components","../../../src/hooks/socket","../../src/components","../../src/hooks/socket","code-plug","lodash","react","rsuite"],(e,t,n,r,o,s,a,i)=>(()=>{var l={415:(e,t,n)=>{"use strict";n.r(t);var r=n(297),o=n.n(r),s=n(222),a=n(804),i=n.n(a),l=n(738),c=n(337),u=n.n(c);let p;null!=window.AppContext?p=window.AppContext:(p=o().createContext({}),window.AppContext=p);const d=p,m=()=>{const{client:e,platforms:t,eventTypes:n,messageTypes:o,activeChatbots:s}=(0,r.useContext)(d);return{client:e,platforms:t,eventTypes:n,messageTypes:o,activeChatbots:s}},f=e=>i().isEmpty(e.first_name)&&i().isEmpty(e.last_name)?i().isEmpty(username)?"Anonymous (id: {id})":e.username:[e.first_name,e.last_name].filter(e=>!i().isEmpty(e)).join(" "),h=({value:e,validation:t,onChange:n=(()=>{}),onSubmit:r=(()=>{})})=>{const{activeChatbots:a}=m();return o().createElement("div",null,o().createElement(s.Form,{fluid:!0,formValue:e,onChange:n,formError:t},o().createElement(s.FlexboxGrid,{justify:"space-between"},o().createElement(s.FlexboxGrid.Item,{colspan:15},o().createElement(s.FormGroup,null,o().createElement(s.ControlLabel,null,"Recipient"),o().createElement(s.FormControl,{name:"recipient",accepter:l.UserAutocomplete,cleanable:!0,onChange:t=>{if(null!=t&&_.isArray(t.chatIds)&&!_.isEmpty(t.chatIds)){const r=t.chatIds.find(e=>((e,t)=>e.some(e=>e.transport===t))(a,e.transport));null!=r&&n({...e,chatId:r.chatId,recipient:t,botNode:a.find(e=>e.transport===r.transport).nodeId})}}}))),o().createElement(s.FlexboxGrid.Item,{colspan:8},o().createElement(s.FormGroup,null,o().createElement(s.ControlLabel,null,"Transport",o().createElement(s.HelpBlock,{tooltip:!0},"Shows only platforms for which the selected users has a valid ",o().createElement("em",null,"chatId"))),o().createElement(s.FormControl,{name:"botNode",accepter:l.SelectTransport,transports:null!=e.recipient?e.recipient.chatIds.map(e=>e.transport):null,disabled:null==e.recipient,onChange:t=>{const r=a.find(e=>e.nodeId===t);if(null!=r&&null!=e.recipient){const o=e.recipient.chatIds.find(e=>e.transport===r.transport);null!=o&&n({...e,chatId:o.chatId,botNode:t})}},block:!0})))),o().createElement(s.FormGroup,{style:{marginTop:"15px"}},o().createElement(s.ControlLabel,null,"Message to send"),o().createElement(s.FormControl,{name:"message",componentClass:"textarea",style:{height:"100%"},onKeyUp:e=>{e.shiftKey&&13===e.keyCode&&r()}}))))},{useModal:g}=l.Modal,b=e=>null!=e.recipient&&null!=e.chatId&&null!=e.botNode&&!i().isEmpty(e.message),{StringType:v,ObjectType:y}=s.Schema.Types,E=(s.Schema.Model({recipient:y().isRequired("Select recipient"),botNode:v().isRequired("Select chatbot platoform"),message:v().isRequired("Enter message for the user")}),({user:e,appearance:t="ghost",transport:n})=>{const{sendMessage:r}=u()(),{activeChatbots:a}=m(),{open:l,close:c,validate:p,error:d,disable:v,openWithModel:y,openWith:E}=g({view:h,title:"Send message",labelSubmit:"Send message",size:"sm"});let x,C;if(!i().isEmpty(n)){if(e.chatIds.some(e=>e.transport===n)){const t=a.find(e=>e.transport===n);console.log("chatBot",t,a,n),null!=t&&(x=t.nodeId,C=e.chatIds.find(e=>e.transport===n).chatId)}}return o().createElement(s.Button,{appearance:t,onClick:async()=>{let t={recipient:e,botNode:x,chatId:C,message:""};t=await E(t,b),t&&(r("message.send",t),s.Notification.success({title:"Message sent",description:`Message sent successfully to "${f(t.recipient)}"`}))}},"Contact User")});var x=n(399),C=n(186),w=n(770),S=n.n(w);n(470);const{WidgetForm:I,Content:M,Footer:T}=C.WidgetForm;(0,x.plug)("widgets",({stats:e})=>{const[t,n]=(0,r.useState)({message:""}),a=!_.isEmpty(t.chatId)&&!_.isEmpty(t.botNode),{sendMessage:i}=S()();return o().createElement(C.Panel,{title:"Send Message",className:"widget-send-message"},o().createElement(I,{fluid:!0,formValue:t,onChange:e=>n(e)},o().createElement(M,null,o().createElement(h,{value:t,onChange:e=>n(e),onSubmit:()=>{i("message.send",t),n({...t,message:""})}})),o().createElement(T,null,o().createElement(s.FormGroup,null,o().createElement(s.ButtonToolbar,null,o().createElement(s.Button,{appearance:"primary",disabled:!a,onClick:()=>{i("message.send",t),n({...t,message:""})}},"Send Message"),o().createElement("div",{className:"key-hint"},"Shift + Enter to Send"),o().createElement(s.Button,{style:{float:"right"},appearance:"default",onClick:()=>n({botNode:null,recipient:null,chatId:null,message:""})},"Cancel"))))))},{x:0,y:0,w:2,h:6,isResizable:!0,id:1}),(0,x.plug)("user-button",E),(0,x.plug)("user-record-buttons",({record:e})=>o().createElement(E,{transport:e.transport,appearance:"primary",user:e.user}),{type:"survey"})},155:(e,t,n)=>{var r=n(645);(e.exports=r(!1)).push([e.id,".widget-send-message .rs-form-group{flex:1 0;display:flex;flex-direction:column;flex-wrap:nowrap;justify-content:flex-start;align-content:stretch;align-items:stretch}.widget-send-message .rs-form-group .rs-form-control-wrapper{flex:1 0}.widget-send-message .key-hint{color:#999999;display:inline-block}\n",""])},645:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=function(e,t){var n=e[1]||"",r=e[3];if(!r)return n;if(t&&"function"==typeof btoa){var o=(a=r,i=btoa(unescape(encodeURIComponent(JSON.stringify(a)))),l="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(i),"/*# ".concat(l," */")),s=r.sources.map((function(e){return"/*# sourceURL=".concat(r.sourceRoot).concat(e," */")}));return[n].concat(s).concat([o]).join("\n")}var a,i,l;return[n].join("\n")}(t,e);return t[2]?"@media ".concat(t[2],"{").concat(n,"}"):n})).join("")},t.i=function(e,n){"string"==typeof e&&(e=[[null,e,""]]);for(var r={},o=0;o<this.length;o++){var s=this[o][0];null!=s&&(r[s]=!0)}for(var a=0;a<e.length;a++){var i=e[a];null!=i[0]&&r[i[0]]||(n&&!i[2]?i[2]=n:n&&(i[2]="(".concat(i[2],") and (").concat(n,")")),t.push(i))}},t}},470:(e,t,n)=>{var r=n(155);"string"==typeof r&&(r=[[e.id,r,""]]);var o={insert:"head",singleton:!1};n(379)(r,o);r.locals&&(e.exports=r.locals)},379:(e,t,n)=>{"use strict";var r,o={},s=function(){return void 0===r&&(r=Boolean(window&&document&&document.all&&!window.atob)),r},a=function(){var e={};return function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}e[t]=n}return e[t]}}();function i(e,t){for(var n=[],r={},o=0;o<e.length;o++){var s=e[o],a=t.base?s[0]+t.base:s[0],i={css:s[1],media:s[2],sourceMap:s[3]};r[a]?r[a].parts.push(i):n.push(r[a]={id:a,parts:[i]})}return n}function l(e,t){for(var n=0;n<e.length;n++){var r=e[n],s=o[r.id],a=0;if(s){for(s.refs++;a<s.parts.length;a++)s.parts[a](r.parts[a]);for(;a<r.parts.length;a++)s.parts.push(g(r.parts[a],t))}else{for(var i=[];a<r.parts.length;a++)i.push(g(r.parts[a],t));o[r.id]={id:r.id,refs:1,parts:i}}}}function c(e){var t=document.createElement("style");if(void 0===e.attributes.nonce){var r=n.nc;r&&(e.attributes.nonce=r)}if(Object.keys(e.attributes).forEach((function(n){t.setAttribute(n,e.attributes[n])})),"function"==typeof e.insert)e.insert(t);else{var o=a(e.insert||"head");if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(t)}return t}var u,p=(u=[],function(e,t){return u[e]=t,u.filter(Boolean).join("\n")});function d(e,t,n,r){var o=n?"":r.css;if(e.styleSheet)e.styleSheet.cssText=p(t,o);else{var s=document.createTextNode(o),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(s,a[t]):e.appendChild(s)}}function m(e,t,n){var r=n.css,o=n.media,s=n.sourceMap;if(o&&e.setAttribute("media",o),s&&btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),e.styleSheet)e.styleSheet.cssText=r;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(r))}}var f=null,h=0;function g(e,t){var n,r,o;if(t.singleton){var s=h++;n=f||(f=c(t)),r=d.bind(null,n,s,!1),o=d.bind(null,n,s,!0)}else n=c(t),r=m.bind(null,n,t),o=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(n)};return r(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;r(e=t)}else o()}}e.exports=function(e,t){(t=t||{}).attributes="object"==typeof t.attributes?t.attributes:{},t.singleton||"boolean"==typeof t.singleton||(t.singleton=s());var n=i(e,t);return l(n,t),function(e){for(var r=[],s=0;s<n.length;s++){var a=n[s],c=o[a.id];c&&(c.refs--,r.push(c))}e&&l(i(e,t),t);for(var u=0;u<r.length;u++){var p=r[u];if(0===p.refs){for(var d=0;d<p.parts.length;d++)p.parts[d]();delete o[p.id]}}}}},738:t=>{"use strict";t.exports=e},337:e=>{"use strict";e.exports=t},186:e=>{"use strict";e.exports=n},770:e=>{"use strict";e.exports=r},399:e=>{"use strict";e.exports=o},804:e=>{"use strict";e.exports=s},297:e=>{"use strict";e.exports=a},222:e=>{"use strict";e.exports=i}},c={};function u(e){if(c[e])return c[e].exports;var t=c[e]={id:e,exports:{}};return l[e](t,t.exports,u),t.exports}return u.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return u.d(t,{a:t}),t},u.d=(e,t)=>{for(var n in t)u.o(t,n)&&!u.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},u.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),u.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},u(415)})());